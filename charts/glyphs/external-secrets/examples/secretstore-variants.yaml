name: externalsecrets-secretstore-variants

# Different SecretStore configurations
# Shows namespace-scoped vs cluster-scoped stores, different auth methods

lexicon:
  # Vault server config (required for path generation)
  - chapter: base-system
    skipVerify: true
    type: vault
    url: http://vault.vault.svc:8200
    namespace: vault
    serviceAccount: vault
    authPath: k8s-path-auth
    secretPath: kv
    labels:
      default: book
      provider: vault

  # SecretStore metadata (for runic indexer discovery)
  - name: vault-cluster-store
    type: secret-store
    mode: cluster
    labels:
      default: book
      provider: vault
  
  - name: vault-namespace-store
    type: secret-store
    mode: ""
    labels:
      default: book
      provider: vault
  
  - name: vault-custom-auth
    type: secret-store
    mode: cluster
    labels:
      auth: custom
      provider: vault
  
  - name: vault-token-auth
    type: secret-store
    mode: cluster
    labels:
      auth: token
      provider: vault

glyphs:
  external-secrets:
    # Cluster-scoped SecretStore (default)
    - type: secret-store
      mode: cluster
      name: vault-cluster-store
      provider:
        type: vault
        selector:
          provider: vault
          default: book

    # Namespace-scoped SecretStore
    - type: secret-store
      mode: ""  # Empty mode = SecretStore (namespace-scoped)
      name: vault-namespace-store
      provider:
        type: vault
        selector:
          provider: vault
          default: book

    # SecretStore with custom Kubernetes auth
    - type: secret-store
      mode: cluster
      name: vault-custom-auth
      provider:
        type: vault
        selector:
          provider: vault
          auth: custom
        config:
          server: http://vault-alternate.vault.svc:8200
          path: secret
          auth:
            kubernetes:
              mountPath: k8s-custom
              role: custom-role
              serviceAccountRef:
                name: custom-sa
                namespace: custom-namespace

    # SecretStore with token auth (from secret)
    - type: secret-store
      mode: cluster
      name: vault-token-auth
      provider:
        type: vault
        selector:
          provider: vault
          auth: token
        config:
          server: http://vault.vault.svc:8200
          path: kv
          auth:
            tokenSecretRef:
              name: vault-token
              key: token
              namespace: vault

    # ExternalSecrets using different stores

    # Uses cluster store (default)
    - type: external-secret
      name: uses-cluster-store
      selector:
        provider: vault
        default: book
      path: chapter

    # Uses specific namespace store
    - type: external-secret
      name: uses-namespace-store
      selector:
        provider: vault
        default: book
      path: chapter

    # Uses custom auth store
    - type: external-secret
      name: uses-custom-auth
      selector:
        provider: vault
        auth: custom
      path: /custom/path
