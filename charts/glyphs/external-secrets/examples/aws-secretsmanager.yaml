name: externalsecrets-aws-secretsmanager

# AWS Secrets Manager provider example
# Shows IRSA (IAM Roles for Service Accounts) authentication

# NOTE: This example requires External Secrets Operator with AWS provider installed

lexicon:
  # AWS SecretStore metadata (for runic indexer discovery)
  - name: aws-secretsmanager
    type: secret-store
    mode: cluster
    labels:
      provider: aws
      region: us-east-1
      auth: irsa

glyphs:
  external-secrets:
    # AWS ClusterSecretStore with IRSA auth
    - type: secret-store
      mode: cluster
      name: aws-secretsmanager
      provider:
        type: aws
        config:
          service: SecretsManager
          region: us-east-1
          serviceAccount:
            name: external-secrets-sa
            namespace: external-secrets

    # ExternalSecret with chapter path
    - type: external-secret
      name: db-credentials
      selector:
        provider: aws
        region: us-east-1
      path: chapter
      # Result: my-app/production/publics/db-credentials

    # ExternalSecret with custom absolute path
    - type: external-secret
      name: api-keys
      selector:
        provider: aws
        region: us-east-1
      path: /production/keys
      # Result: /production/keys

    # ExternalSecret with explicit remoteRef keys
    - type: external-secret
      name: app-config
      selector:
        provider: aws
        region: us-east-1
      data:
        - secretKey: database_url
          remoteRef:
            key: prod/database/connection-string
        - secretKey: api_token
          remoteRef:
            key: prod/external-api/token
