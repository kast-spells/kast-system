# Example: Custom Password Policies with Random Secrets
# Shows how to create custom password policies and use them with random secrets

lexicon:
  - chapter: base-system
    skipVerify: true
    type: vault
    url: http://vault.vault.svc:8200
    namespace: vault
    serviceAccount: vault
    authPath: k8s-path-auth
    secretPath: kv
    labels:
      default: book

glyphs:
  vault:
    # Create custom password policies with different complexity levels

    # Simple policy - alphanumeric only, 16 chars
    - type: defaultPasswordPolicy
      name: simple-alphanumeric
      length: 16
      minLowercase: 4
      minUppercase: 4
      minNumbers: 4
      minSymbols: 0  # No special characters

    # Strong policy - all character types, 24 chars
    - type: defaultPasswordPolicy
      name: strong-password
      length: 24
      minLowercase: 6
      minUppercase: 6
      minNumbers: 6
      minSymbols: 6  # Requires special characters

    # Ultra-strong policy - maximum complexity, 32 chars
    - type: defaultPasswordPolicy
      name: ultra-strong
      length: 32
      minLowercase: 8
      minUppercase: 8
      minNumbers: 8
      minSymbols: 8

    # API key policy - very long, alphanumeric
    - type: defaultPasswordPolicy
      name: api-key-policy
      length: 48
      minLowercase: 12
      minUppercase: 12
      minNumbers: 12
      minSymbols: 0  # API keys typically don't use special chars

    # PIN policy - numbers only, short
    - type: defaultPasswordPolicy
      name: pin-code
      length: 6
      minLowercase: 0
      minUppercase: 0
      minNumbers: 6
      minSymbols: 0

    # Now create secrets using these custom policies

    # Database admin with ultra-strong password
    - type: secret
      name: database-admin-credentials
      format: plain
      randomKey: admin-password
      passPolicyName: ultra-strong
      keys:
        - username
      staticData:
        username: db_admin
        database: production_db
        host: postgres.production.svc

    # API credentials with API key policy
    - type: secret
      name: external-api-credentials
      format: plain
      randomKey: api-key
      passPolicyName: api-key-policy
      keys:
        - client-id
      staticData:
        client-id: myapp-production
        endpoint: https://api.external-service.com

    # User account with strong password
    - type: secret
      name: user-account-credentials
      format: plain
      randomKey: user-password
      passPolicyName: strong-password
      keys:
        - email
      staticData:
        email: user@example.com
        role: standard

    # Service account with simple alphanumeric
    - type: secret
      name: service-account-token
      format: plain
      randomKey: token
      passPolicyName: simple-alphanumeric
      keys:
        - service-name
      staticData:
        service-name: background-worker
        environment: staging

    # Device PIN code
    - type: secret
      name: device-access
      format: plain
      randomKey: pin
      passPolicyName: pin-code
      keys:
        - device-id
      staticData:
        device-id: IOT-DEVICE-001
        location: warehouse-a

    # Multiple random fields in one secret with different policies
    # Note: This requires separate secret definitions for each policy
    - type: secret
      name: multi-credential-main
      format: plain
      randomKey: master-password
      passPolicyName: ultra-strong
      keys:
        - account-id
      staticData:
        account-id: ACCT-12345
        created: "2024-01-01"

    # Additional secret for secondary password
    - type: secret
      name: multi-credential-secondary
      format: plain
      randomKey: backup-password
      passPolicyName: strong-password
      keys:
        - account-id
      staticData:
        account-id: ACCT-12345
        type: backup

    # Example with auto-refresh of passwords
    - type: secret
      name: rotating-credentials
      format: plain
      randomKey: rotating-password
      passPolicyName: strong-password
      refreshPeriod: 86400  # Rotate daily (in seconds)
      keys:
        - service
      staticData:
        service: rotating-service
        rotation-enabled: "true"