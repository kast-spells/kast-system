# Comprehensive Vault Secrets Test for Microspell
# Tests all vault secret scenarios and configurations

spellbook:
  name: example-tdd-book
chapter:
  name: infrastructure

# Test vault lexicon configuration
lexicon:
  - chapter: infrastructure
    skipVerify: true
    type: vault
    url: http://vault.vault.svc:8200
    namespace: vault
    serviceAccount: vault
    authPath: k8s-path-auth
    secretPath: kv
    labels:
      default: book

name: vault-test-service
repository: https://github.com/test-org/vault-test-service.git
revision: v1.0.0
path: helm-chart

image:
  repository: registry.example.com/vault-test-service
  tag: v1.0.0

# Service configuration
service:
  enabled: true
  external: true
  ports:
    - port: 80
      name: http
  prefix: /api/vault-test

# Vault policy for secure access
infrastructure:
  prolicy:
    enabled: true
    paths:
      - "kv/data/vault-test-service/*"
    capabilities:
      - read
      - list

# Environment setup
envs:
  ENV: test
  SERVICE_NAME: vault-test-service
  LOG_LEVEL: debug

# Comprehensive secrets testing all vault scenarios
secrets:
  # TEST 1: Chapter path with plain format
  chapter-plain-secret:
    location: vault
    path: chapter
    private: privates
    format: plain
    keys:
      - username
      - password
      - host
    
  # TEST 2: Book path with env format
  book-env-secret:
    location: vault
    path: book
    private: secrets
    format: env
    keys:
      - api-key
      - jwt-secret
      - redis-url
    staticData:
      environment: production
      region: us-west-1
      
  # TEST 3: Absolute path with json format
  absolute-json-secret:
    location: vault
    path: /shared/config
    format: json
    key: config-data
    
  # TEST 4: Default path with yaml format
  default-yaml-secret:
    location: vault
    format: yaml
    key: service-config
    keys:
      - database-url
      - cache-endpoint
      
  # TEST 5: B64 format
  encoded-secret:
    location: vault
    path: chapter
    private: encoded
    format: b64
    key: certificate-data
    
  # TEST 6: Mixed with created secrets
  local-created-secret:
    location: create
    type: env
    content: local-test-value-123
    contentType: yaml
    
  # TEST 7: Secret with custom service account
  custom-sa-secret:
    location: vault
    path: book
    private: sensitive
    format: plain
    serviceAccount: custom-vault-reader
    refreshPeriod: 5m0s
    keys:
      - token
      - endpoint
      
  # TEST 8: Secret with custom metadata
  metadata-secret:
    location: vault
    path: chapter  
    private: publics
    format: env
    keys:
      - database-host
      - database-port
    annotations:
      vault.io/source: "external-secrets"
      reloader.stakater.com/match: "true"
    labels:
      app: vault-test-service
      tier: backend
      environment: test
      
  # TEST 9: Secret with special characters in keys
  special-chars-secret:
    location: vault
    path: book
    private: config
    format: env
    keys:
      - "api-key"
      - "database.host"  
      - "service-port"
    staticData:
      special-value: "with-dashes-and.dots"

# Resource configuration
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Workload setup
workload:
  enabled: true
  type: deployment
  replicas: 1