# CronJob Backup Scheduler Example  
# Shows how to use microspell for scheduled backup jobs with vault secrets

spellbook:
  name: example-tdd-book
chapter:
  name: infrastructure

lexicon:
  - chapter: infrastructure
    skipVerify: true
    type: vault
    url: http://vault.vault.svc:8200
    namespace: vault
    serviceAccount: vault
    authPath: k8s-path-auth
    secretPath: kv
    labels:
      default: book

name: backup-scheduler

image:
  name: busybox
  tag: latest
  pullPolicy: IfNotPresent

# CronJob workload configuration
workload:
  enabled: true
  type: cronjob
  schedule: "0 2 * * *"  # Daily at 2 AM
  restartPolicy: OnFailure

# No service needed for cronjobs
service:
  enabled: false

# Backup command
command:
  - /bin/sh
  - -c
  - echo "Starting backup with vault secrets"; sleep 5; echo "Backup completed"

# Environment variables
envs:
  BACKUP_TYPE: incremental
  RETENTION_DAYS: "30"
  LOG_LEVEL: info
  NOTIFICATION_ENABLED: "true"

# Simple vault secret for cronjob
secrets:
  backup-secret:
    location: vault
    path: chapter
    private: backups
    format: env
    keys:
      - backup-key
      - storage-url

# Persistent storage for backups
volumes:
  backup-storage:
    type: pvc
    size: 5Gi
    destinationPath: /backups
    storageClassName: fast-ssd
  logs:
    type: pvc
    size: 1Gi  
    destinationPath: /var/log
    accessMode: ReadWriteOnce

# Service account
serviceAccount:
  enabled: true

# Basic resource limits
resources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi