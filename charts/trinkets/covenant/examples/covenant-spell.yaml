# Example: Covenant Spell
# This shows how to deploy covenant as a spell in bookrack
# Place this file in: bookrack/<your-book>/<chapter>/covenant.yaml

name: covenant

# Covenant trinket needs kaster to render keycloak glyphs
# So we use the "trinkets" approach (librarian will detect it)

covenant:
  # Realm configuration
  realm:
    name: kast
    displayName: "Kast Organization"

  # Global roles
  roles:
    admin:
      description: "Administrator"
      composite: true
    developer:
      description: "Developer"
      composite: false
    viewer:
      description: "Read-only viewer"
      composite: false

  # Keycloak clients for service integrations
  integrations:
    clients:
      vault:
        enabled: true
        clientId: vault
        webUrl: https://vault.example.com
        redirectUris:
          - https://vault.example.com/ui/vault/auth/oidc/oidc/callback
        defaultClientScopes:
          - profile
          - email
          - roles
          - groups

      argocd:
        enabled: true
        clientId: argocd
        webUrl: https://argocd.example.com
        redirectUris:
          - https://argocd.example.com/auth/callback

      forgejo:
        enabled: true
        clientId: forgejo
        webUrl: https://git.example.com
        redirectUris:
          - https://git.example.com/user/oauth2/keycloak/callback

      harbor:
        enabled: true
        clientId: harbor
        webUrl: https://harbor.example.com
        redirectUris:
          - https://harbor.example.com/c/oidc/callback

# Lexicon: Keycloak realm reference
lexicon:
  kast-realm:
    type: keycloak-realm
    labels:
      default: book
    realmName: kast
