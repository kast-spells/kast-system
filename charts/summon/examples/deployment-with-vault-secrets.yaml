# Deployment with Vault Secrets Example
# Shows how to use vault glyphs with summon to inject secrets

spellbook:
  name: example
chapter:
  name: test

# Vault lexicon configuration
lexicon:
  - type: vault
    url: http://vault.vault.svc:8200
    namespace: vault
    serviceAccount: vault
    secretPath: kv
    skipVerify: true
    labels:
      default: book

name: app-with-vault
namespace: test

image:
  repository: nginx
  tag: latest

# Workload configuration
workload:
  enabled: true
  type: deployment
  replicas: 1

# Service configuration  
service:
  enabled: true
  ports:
    - port: 80
      name: http

# Environment variables
envs:
  APP_ENV: production
  LOG_LEVEL: info

# Vault glyphs create the secrets
vault:
  policy:
    type: prolicy
    enabled: true
    name: app-policy
  credentials:
    type: secret
    enabled: true
    name: api-credentials
    format: env
    keys:
      - API_KEY
      - API_SECRET
    staticData:
      API_VERSION: "v1"
    random: true
    randomKey: API_TOKEN

# Reference vault secrets in deployment
secrets:
  api-credentials:
    contentType: env  # This makes summon include it in envFrom
    # No location needed - references existing secret created by vault glyph

serviceAccount:
  enabled: true